<?php
/**
 * Implementation of hook_init().
 */
function region_filter_init() {

}


function region_filter_nodeapi(&$node, $op, $a3 = NULL, $a4 = NULL) {
  global $user, $base_url;
  switch ($op) {

    case 'view':

      if( (arg(1) == 0)){ 
	  
	  
	  
	  
}
	  
	  else {
	  
        $region = getRegion();
        /*$other = array('boston', 'burlington', 'connecticut', 'portland-me', 'providence');*/
        $national = 'national';
       // $node = node_load(arg(1));
        $count = count($node->taxonomy);
        
        $terms = array();
        foreach($node->taxonomy as $term) {    
          $terms[$term->name] = $term->name;
        }
        
	
	/*case 1 new england*/
	
	if( $count < 9 &&  in_array('newengland', $terms) && $region != 'newengland')
	{
	     $link = 'http://newengland.thedelimagazine.com/' . drupal_get_path_alias("node/$node->nid", $path_language = '');
               drupal_goto($link, $query = NULL, $fragment = NULL, $http_response_code = 301);
	 
	}
	
	/*END case 1 new england*/
	
	
         /*++++++++case 2+++++++++ */
        elseif($count == 2 && in_array('national', $terms) && !in_array('los angeles', $terms)) {
          unset($terms['national']);
          $value = array_shift($terms) ;
          if($region != $value) {
            $link = 'http://' . $value . '.thedelimagazine.com/' . drupal_get_path_alias("node/$node->nid", $path_language = '');
            drupal_goto($link, $query = NULL, $fragment = NULL, $http_response_code = 301);
          }         
        }
	
        /* ++ END case 2++*/
       
        /*  ++++++++case 3 national+++++++++ */ 
        else {
	
	if($count > 10  && in_array('national', $terms)  && $region != 'national' ) {                  
          $link = 'http://national.thedelimagazine.com/' . drupal_get_path_alias("node/$node->nid", $path_language = '');;
          drupal_goto($link, $query = NULL, $fragment = NULL, $http_response_code = 301);     
        }
         /* ++ END case 3 national++*/
         }
     }
      break;
  }
}
